
<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">
<!-- Mirrored from themesbrand.com/velzon/html/material/tables-listjs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 13 Jan 2024 06:45:56 GMT -->
<head th:replace="~{layout :: head}">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>
</head>
<style>
    .error{
        color:red;
    }

</style>
<style>
    .round-image {
        border-radius: 50%;
        width: 40px; /* Adjust the size as needed */
        height: 40px; /* Adjust the size as needed */
    }
</style>
<body>

<!-- Begin page -->
<div id="layout-wrapper">

    <div id="header-container">
        <header th:replace="~{header::header}"></header>
    </div>

    <!-- ========== App Menu ========== -->
    <div id="navbar-container">
        <div th:replace="~{navbar::navbar}"></div>
    </div>
</div>
    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title mb-0">Users</h4>
                            </div><!-- end card header -->

                            <div class="card-body">
                                <div class="listjs-table" id="customerList">
                                    <div class="row g-4 mb-3">
                                        <div class="col-sm-auto">
                                            <div>
                                                <button type="button" class="btn btn-success add-btn" data-bs-toggle="modal" id="create-btn" data-bs-target="#addmemberModal">
                                                    <i class="ri-add-line align-bottom me-1"></i> Add
                                                </button>
                                                <button class="btn btn-soft-danger" onClick="deleteMultiple()"><i class="ri-delete-bin-2-line"></i></button>
                                            </div>
                                        </div>
<!--                                        <div class="col-sm">-->
<!--                                            <div class="d-flex justify-content-sm-end">-->
<!--                                                <div class="search-box ms-2">-->
<!--                                                    <input type="text" class="form-control search" placeholder="Search...">-->
<!--                                                    <i class="ri-search-line search-icon"></i>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
                                    </div>

                                    <div class="table-responsive table-card mt-3 mb-1">
                                        <table id="UserTable" class="table align-middle mb-0  table-striped table-hover table1 display" >

                                            <thead style="background-color:#cdcdcd" >
                                            <tr class="space ">
                                                <th style="text-align: center;" class="fs-6 fw-bold">Users</th>
                                                <th style="text-align: center;" class="fs-6 fw-bold">Profile</th>
                                                <th style="text-align: center;" class="fs-6 fw-bold">PositionRepository</th>
                                               <th style="text-align: center;" class="fs-6 fw-bold">Department</th>
                                                <th style="text-align: center;" class="fs-6 fw-bold">Email</th>
                                                <th style="text-align: center;" class="fs-6 fw-bold">Status</th>
                                                <th style="text-align: center;" class="fs-6 fw-bold">Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>


                                                <tr class="position" th:each="user : ${users}">
                                                    <td style="text-align: center;" th:text="${user.getName()}"></td>
                                                    <td>
                                                        <img th:src="@{'/assets/images/userPhoto/' + ${user.getPhoto()}}" alt="image" class="round-image" />
                                                    </td>

<!--                                                    <td style="text-align: center;" th:text="${user.getPhone()}"></td>-->
<!--                                                    <td style="text-align: center;" th:text="${user.getPosition().getName()}"></td>-->
<!--                                                    <td style="text-align: center;" th:text="${user.getDepartment().getName()}"></td>-->
                                                    <td style="text-align: center;" th:text="${user.getEmail()}"></td>


                                                    <td style="text-align: center;" class="status"><span class="badge bg-success-subtle text-success text-uppercase">Active</span></td>
                                                    <td >
                                                        <div style="text-align: center;" class="d-flex gap-2">
                                                            <div class="Detail">
                                                                <button class="btn btn-sm btn-primary detail-item-btn" data-bs-toggle="modal" data-bs-target="#showDetailModal">Detail</button>
                                                            </div>
                                                            <div class="edit">
                                                                <button class="btn btn-sm btn-success edit-item-btn" data-bs-toggle="modal" data-bs-target="#showModal">Edit</button>
                                                            </div>
                                                            <div class="remove">
                                                                <button class="btn btn-sm btn-danger remove-item-btn" data-bs-toggle="modal" data-bs-target="#deleteRecordModal">Remove</button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>

                                            </tbody>

                                        </table>
                                        <div class="noresult" style="display: none">
                                            <div class="text-center">
                                                <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#121331,secondary:#08a88a" style="width:75px;height:75px">
                                                </lord-icon>
                                                <h5 class="mt-2">Sorry! No Result Found</h5>
                                                <p class="text-muted mb-0">We've searched more than 150+ Orders We did not find any
                                                    orders for you search.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-end">
                                        <div class="pagination-wrap hstack gap-2">
                                            <a class="page-item pagination-prev disabled" href="javascript:void(0);">
                                                Previous
                                            </a>
                                            <ul class="pagination listjs-pagination mb-0"></ul>
                                            <a class="page-item pagination-next" href="javascript:void(0);">
                                                Next
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div><!-- end card -->
                        </div>
                        <!-- end col -->
                    </div>
                    <!-- end col -->
                </div>

                <!-- User Add Modal -->
                <div class="modal fade" id="addmemberModal" tabindex="-1" aria-labelledby="addmemberModalLabel" aria-hidden="true">
                    <div class="modal-dialog  modal-lg">
                        <div class="modal-content border-0">

                            <div class="modal-header p-3 bg-warning-subtle">
                                <h5 class="modal-title" id="addmemberModalLabel">Add Member</h5>
                                <button type="button" class="btn-close" id="btn-close-member" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Form Input through Javascript -->
                                <form id="userAddForm"  enctype="multipart/form-data">
                                    <div class="row g-3">
                                        <!-- Image -->
                                        <legend><center><h2><b>Registration Form</b></h2></center></legend><br>

                                        <div class="col-lg-12">
                                            <label for="profilePicture" class="form-label">Profile Picture</label>
                                            <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 20px;">
                                                <img id="preview-image" style="height: 200px; width: 200px; border-radius: 25%;" src="/assets/images/about.jpg" alt="Your Image">

                                                <input type="file" id="profilePicture" accept="image/*" style="display: none;" onchange="previewImage(event)">

                                                <label for="profilePicture" class="btn btn-soft-primary" style="margin-top: 10px;">
                                                    Upload
                                                </label>
                                            </div>
                                        </div>

                                        <!-- Divider -->
                                        <hr style="padding-top: 10px;">
                                        <div>
                                            <h5>Company Info</h5>
                                        </div>
                                        <!--Name field-->
                                        <div class="col-lg-6">
                                            <label for="name" class="form-label">User</label>
                                            <div class="input-group  input-success-o ">

                                                    <span class="input-group-text">
                                                        <i class="bx bx-user-circle "  style="font-size: 24px;"></i>
                                                    </span>
                                                <input type="text" class="form-control" id="name" th:class="form-control"    th:required="required" placeholder="Username">
                                            </div>
                                        </div>

                                        <!--department col-->
                                        <div class="col-lg-12">
                                            <label for="department" class="form-label">Department / Office</label>
                                            <div class="input-group">

                                                 <span class="input-group-text">
                                                    <i class="ri-building-4-line " style="font-size: 17px;"></i>
                                                 </span>
                                                <!-- Add a select element with an ID for JavaScript interaction -->
                                                <select id="department" class="form-select"></select>
                                            </div>
                                        </div>

                                        <!--position col-->
                                        <div class="col-lg-12">
                                            <label for="position" class="form-label">Position</label>
                                            <div class="input-group">

                                                 <span class="input-group-text">
                                                    <i class="ri-building-4-line " style="font-size: 17px;"></i>
                                                 </span>
                                                <!-- Add a select element with an ID for JavaScript interaction -->
                                                <select id="position" class="form-select"></select>
                                            </div>
                                        </div>


                                        <!-- Divider -->
                                        <hr style="padding-top: 10px;">
                                        <div>
                                            <h5>Personal Info</h5>
                                        </div>


                                        <div class="col-lg-6">
                                            <label for="gender" class="form-label">Gender</label>
                                            <fieldset class="row" id="gender">
                                                <div>
                                                    <div class="form-check-inline col-md-6">
                                                        <input class="form-check-input" type="radio" id="maleRadio" name="gender" value="male">
                                                        <label class="form-check-label" for="maleRadio">
                                                            Male
                                                        </label>
                                                    </div>
                                                    <div class="form-check-inline">
                                                        <input class="form-check-input" type="radio" id="femaleRadio" name="gender" value="female">
                                                        <label class="form-check-label" for="femaleRadio">
                                                            Female
                                                        </label>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>

                                        <!-- Date Of Birth field -->
                                        <div class="col-lg-6">
                                            <label for="dob" class="form-label">Date of Birth</label>
                                            <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-cake-2-fill" style="font-size: 17px;"></i>
                                                 </span>
                                                <input type="date" class="form-control" id="dob">
                                            </div>
                                        </div>

                                        <!-- Education field -->
                                        <div class="col-lg-12">
                                            <label for="education" class="form-label">Education</label>
                                            <div class="input-group">
                                                <span class="input-group-text">
                                                     <i class="ri-stack-fill " style="font-size: 17px;"></i>
                                                </span>
                                                <select id="education" class="form-control selectpicker">
                                                    <option value="" selected disabled>Select your Education</option>
                                                    <option value="Bachelor of Information Technology">Bachelor of Information Technology</option>
                                                    <option value="Bachelor of Computer Science">Bachelor of Computer Science</option>
                                                    <option value="Bachelor of Engineering">Bachelor of Engineering</option>
                                                    <option value="Diploma in IT">Diploma in IT</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Divider -->
                                        <hr style="padding-top: 10px;">
                                        <div>
                                            <h5>Contact Info</h5>
                                        </div>


                                        <!-- E-Mail field -->
                                        <div class="col-lg-6">
                                            <label for="email" class="form-label">E-Mail</label>
                                            <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-mail-line" style="font-size: 17px;"></i>
                                                 </span>
                                                <input type="email" class="form-control" id="email" placeholder="E-Mail Address">
                                            </div>
                                        </div>

                                        <!-- Contact No. field -->
                                        <div class="col-lg-6">
                                            <label for="phone" class="form-label">Contact No.</label>
                                            <div class="input-group input-success-o">
                                                    <span class="input-group-text">
                                                        <i class="ri-phone-line" style="font-size: 17px;"></i>
                                                    </span>
                                                <input type="text" class="form-control" id="phone" placeholder="(+959)">
                                            </div>
                                        </div>

                                        <!-- Address field -->
                                        <div class="col-lg-12">
                                            <label for="address" class="form-label">Address</label>
                                            <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-home-heart-fill" style="font-size: 17px;"></i>
                                                </span>
                                                <textarea placeholder="Address" id="address" class="form-control" type="text"></textarea>
                                            </div>
                                        </div>


                                        <!-- Password field -->
                                        <div class="col-lg-6">
                                            <label for="password" class="form-label">Password</label>
                                            <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-lock-2-fill" style="font-size: 24px;"></i>
                                                </span>
                                                <input type="password" class="form-control" id="password" placeholder="Enter Your Password" autocomplete="current-password">

                                            </div>
                                        </div>

                                        <hr>

                                    </div>
                                    <!--end row-->
                                    <div class="modal-footer" style="padding-top: 10px;">
                                        <button type="button" class="btn btn-light" data-bs-dismiss="modal"><i class="ri-close-line align-bottom me-1"></i> Close</button>
                                        <button type="submit" id="submitButton" class="btn btn-success" >Add Member</button>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>


                <!--Edit User Form-->
                <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header bg-light p-3">
                                <h5 class="modal-title" >User Edit Form</h5>
                                <button type="button" id="crossEditForm" class="btn-close" data-bs-dismiss="modal" aria-label="Close" ></button>
                            </div>

                            <form id="userEditForm">
                                <div class="modal-body">

                                    <div class="mb-3" style="display: none;">
                                        <label th:for="editId" class="form-label">ID</label>
                                        <input type="hidden" name="id" th:id="editId" th:class="form-control" placeholder="ID" readonly />
                                    </div>

                                    <hr style="padding-top: 10px;">
                                    <div>
                                        <h5>Company Info</h5>
                                    </div>

                                    <div class="col-lg-12">
                                        <label for="editProfilePicture" class="form-label">Profile Picture</label>
                                        <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; margin-bottom: 20px;">
                                            <img id="edit-preview-image" style="height: 200px; width: 200px; border-radius: 25%;" src="/assets/images/about.jpg" alt="Your Image">

                                            <input type="file" id="editProfilePicture" accept="image/*" style="display: none;" onchange="previewImage(event)">

                                            <label for="editProfilePicture" class="btn btn-soft-primary" style="margin-top: 10px;">
                                                Upload
                                            </label>
                                        </div>
                                    </div>

<!--                                    Name-->
                                    <div class="mb-3">
                                        <label th:for="editName" class="form-label">Name</label>
                                        <input type="text" name="name" th:id="editName" th:class="form-control" th:required="required" />
                                        <div class="invalid-feedback">Please enter a Name.</div>
                                    </div>


                                    <!--department col-->
                                    <div class="col-lg-12">
                                        <label th:for="editDepartment" class="form-label">Department / Office</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i class="ri-building-4-line " style="font-size: 17px;"></i>
                                            </span>
                                            <!-- Add a select element with an ID for JavaScript interaction -->
                                            <select id="editDepartment" class="form-select">
                                                <!-- You can add a default option here if needed -->
                                            </select>
                                        </div>
                                    </div>
                                    <!--position col-->
                                    <div class="col-lg-12">
                                        <label th:for="editPosition" class="form-label">Position</label>
                                        <div class="input-group">

                                                 <span class="input-group-text">
                                                    <i class="ri-building-4-line " style="font-size: 17px;"></i>
                                                 </span>
                                            <!-- Add a select element with an ID for JavaScript interaction -->
                                            <select id="editPosition" class="form-select"></select>
                                        </div>
                                    </div>

                                    <div class="col-lg-6">
                                        <label for="gender" class="form-label">Gender</label>
                                        <fieldset class="row" id="editGender">
                                            <div class="form-check-inline col-md-6">
                                                <input class="form-check-input" type="radio" id="editMaleRadio" name="gender" value="male">
                                                <label class="form-check-label" for="maleRadio">Male</label>
                                            </div>
                                            <div class="form-check-inline">
                                                <input class="form-check-input" type="radio" id="editFemaleRadio" name="gender" value="female">
                                                <label class="form-check-label" for="femaleRadio">Female</label>
                                            </div>
                                        </fieldset>
                                    </div>

                                    <!-- Date Of Birth field -->
                                    <div class="col-lg-6">
                                        <label for="editDob" class="form-label">Date of Birth</label>
                                        <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-cake-2-fill" style="font-size: 17px;"></i>
                                                 </span>
                                            <input type="date" class="form-control" id="editDob">
                                        </div>
                                    </div>


                                    <!-- Education field -->
                                    <div class="col-lg-12">
                                        <label for="editEducation" class="form-label">Education</label>
                                        <div class="input-group">
                                                <span class="input-group-text">
                                                     <i class="ri-stack-fill " style="font-size: 17px;"></i>
                                                </span>
                                            <select id="editEducation" class="form-control selectpicker">
                                                <option value="" selected disabled>Select your Education</option>
                                                <option value="Bachelor of Information Technology">Bachelor of Information Technology</option>
                                                <option value="Bachelor of Computer Science">Bachelor of Computer Science</option>
                                                <option value="Bachelor of Engineering">Bachelor of Engineering</option>
                                                <option value="Diploma in IT">Diploma in IT</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Divider -->
                                    <hr style="padding-top: 10px;">
                                    <div>
                                        <h5>Contact Info</h5>
                                    </div>

                                    <!-- E-Mail field -->
                                    <div class="col-lg-6">
                                        <label for="editEmail" class="form-label">E-Mail</label>
                                        <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-mail-line" style="font-size: 17px;"></i>
                                                 </span>
                                            <input type="email" class="form-control" id="editEmail" >
                                        </div>
                                    </div>

                                    <!-- Contact No. field -->
                                    <div class="col-lg-6">
                                        <label for="editPhone" class="form-label">Contact No.</label>
                                        <div class="input-group input-success-o">
                                                    <span class="input-group-text">
                                                        <i class="ri-phone-line" style="font-size: 17px;"></i>
                                                    </span>
                                            <input type="text" class="form-control" id="editPhone" >
                                        </div>
                                    </div>

                                    <!-- Address field -->
                                    <div class="col-lg-12">
                                        <label for="editAddress" class="form-label">Address</label>
                                        <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-home-heart-fill" style="font-size: 17px;"></i>
                                                </span>
                                            <textarea id="editAddress" class="form-control" type="text"></textarea>
                                        </div>
                                    </div>


                                    <!-- Password field -->
                                    <div class="col-lg-6">
                                        <label for="editPassword" class="form-label">Password</label>
                                        <div class="input-group input-success-o">
                                                <span class="input-group-text">
                                                     <i class="ri-lock-2-fill" style="font-size: 24px;"></i>
                                                </span>
                                            <input type="password" class="form-control" id="editPassword"  autocomplete="current-password">
                                        </div>
                                    </div>


                                </hr>



                                    <div class="modal-footer">
                                        <div class="hstack gap-2 justify-content-end">
                                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>

                                            <button type="submit" class="btn btn-success">Confirm Update</button>
                                        </div>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>

                <!--Add User js function-->
                <!--Remove Alert-->
                <!-- Modal -->
                <div class="modal fade zoomIn" id="deleteRecordModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btn-close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mt-2 text-center">
                                    <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#f7b84b,secondary:#f06548" style="width:100px;height:100px"></lord-icon>
                                    <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                                        <h4>Are you Sure ?</h4>
                                        <p class="text-muted mx-4 mb-0">Are you Sure You want to Remove this Record ?</p>
                                    </div>
                                </div>
                                <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                                    <button type="button" class="btn w-sm btn-light" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn w-sm btn-danger " id="delete-record" onclick="deleteUser()">Yes, Delete It!</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end modal -->

            </div>
            <!-- container-fluid -->
        </div>
        <!-- End Page-content -->
    </div>
<!-- END layout-wrapper -->

<div th:replace="~{layout :: footer}"></div>
<!-- Include jQuery first -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Then include DataTables -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<!-- Followed by other scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
<!-- DataTables Buttons CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<!-- DataTables JS -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>


<!-- DataTables Buttons JS -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>


<script defer>

    var deleteUid;
    var userList = [];

    // If you also want to hide the modal when the "Close" button in the modal footer is clicked
    document.querySelector('#editUserModal .modal-footer .btn-light').addEventListener('click', function() {
        var editUserModal = new bootstrap.Modal(document.getElementById('editUserModal'));
        editUserModal.hide();
    });

    // Update the file input and preview image when a file is selected
    document.getElementById('profilePicture').addEventListener('change', function (event) {
        previewImage(event);
    });

    // Function to preview the selected image
    function previewImage(event) {
        const fileInput = event.target;
        const previewImage = document.getElementById('preview-image');

        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                previewImage.src = e.target.result;
            };

            reader.readAsDataURL(fileInput.files[0]);
        }
    }


    // Edit put method form
    document.getElementById("userEditForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission

        const id = document.getElementById('editId').value;
        const name = document.getElementById('editName').value;
        const email = document.getElementById('editEmail').value;
        const phone = document.getElementById('editPhone').value;
        const address = document.getElementById('editAddress').value;
        const password = document.getElementById('editPassword').value;
        const department = document.getElementById('editDepartment').value;
        const position = document.getElementById('editPosition').value;
        const gender = document.querySelector('input[name="gender"]:checked').value;
        const dob = document.getElementById('editDob').value;
        const education = document.getElementById('editEducation').value;

        // Create FormData object
        const formData = new FormData();
        // Check if a file is selected before appending
        const profilePictureInput = document.getElementById('editProfilePicture');
        const selectedFile = profilePictureInput.files[0];
        console.log("Selected File:", selectedFile);

        // If a file is selected, append it to FormData, else use the existing file name
        if (selectedFile) {
            // Append form data to FormData object
            formData.append('id', id);
            formData.append('name', name);
            formData.append('email', email);
            formData.append('phone', phone);
            formData.append('address', address);
            formData.append('password', password);
            formData.append('department', department);
            formData.append('position', position);
            formData.append('gender', gender);
            formData.append('dob', dob);
            formData.append('education', education);

            formData.append('file', selectedFile);
            // Log the FormData before sending the request
            console.log("FormData before sending:", formData);
            fetch(`/api/user/update/${id}`,{
                method: 'PUT',
                body: formData,

            })
                .then(response=>{
                    console.log("Response received from the server:", response);
                    if(!response.ok){
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(updateUserData =>{

                    console.log("User updated successfully:"+ updateUserData);

                    //Close the modal after updating
                    const userEditModal = document.getElementById('editUserModal');
                    userEditModal.classList.remove('show');
                    userEditModal.style.display= 'none';

                    // Reload the browser
                    location.reload();
                })
                .catch(error => {
                    // Handle errors
                    console.error("Error updating user:", error);
                    // You can add more detailed error handling if needed
                });

        } else {
            // User Selector fetching request
            fetch("/api/user/get-lists")
                .then(response => response.json())
                .then(data => {
                    // Assign the array containing user objects to userList
                    userList = data;

                    // Log the userList before find operation
                    console.log("Userlist before find:", userList);


                    // Find the user in the userList
                    const user = userList.find(user => user.id === parseInt(id));
                    // Append form data to FormData object
                    formData.append('id', id);
                    formData.append('name', name);
                    formData.append('email', email);
                    formData.append('phone', phone);
                    formData.append('address', address);
                    formData.append('password', password);
                    formData.append('department', department);
                    formData.append('position', position);
                    formData.append('gender', gender);
                    formData.append('dob', dob);
                    formData.append('education', education);
                    // Create a Blob from the image file path
                    const imagePath = `/static/img/${user.profilePictureFileName}`;
                    fetch(imagePath)
                        .then(response => response.blob())
                        .then(blob => {
                            // Log the FormData before sending the request
                            console.log("FormData before sending:", formData);
                            formData.append('file', blob); // append the Blob data
                            console.log("blob File:", blob);


                            // Now you can use formData in your fetch request
                            fetch(`/api/user/update/${id}`, {
                                method: 'PUT',
                                body: formData,
                            })
                                .then(response => {
                                    console.log("Response received from the server:", response);
                                    if (!response.ok) {
                                        throw new Error(`HTTP error! Status: ${response.status}`);
                                    }
                                    return response.json();
                                })
                                .then(updateUserData => {
                                    console.log("User updated successfully:" + updateUserData);

                                    // Close the modal after updating
                                    const userEditModal = document.getElementById('editUserModal');
                                    userEditModal.classList.remove('show');
                                    userEditModal.style.display = 'none';

                                    // Reload the browser
                                    location.reload();
                                })
                                .catch(error => {
                                    // Handle errors
                                    console.error("Error updating user:", error);
                                    // You can add more detailed error handling if needed
                                });
                        })
                        .catch(error => {
                            console.error("Error creating Blob from image path:", error);
                        });



                })

        }

    });


    // Fetch User details by id for editing
    function displayEditUserModal(id) {
        const user = userList.find(user => user.id === id);
        console.log("User Edit ", user);
        if (user) {
            document.getElementById('editId').value = user.id;
            document.getElementById('editName').value = user.name;
            document.getElementById('editEmail').value= user.email;
            document.getElementById('editPhone').value=user.phone;
            document.getElementById('editAddress').value=user.address;
            document.getElementById('editPassword').value=user.password;


            // Display the fetched image
            const previewImage = document.getElementById('edit-preview-image');
            previewImage.src = `/static/img/${user.profilePictureFileName}`;

            // Display the selected image from the device
            const inputProfilePicture = document.getElementById('editProfilePicture');
            inputProfilePicture.addEventListener('change', function () {
                const selectedImage = inputProfilePicture.files[0];
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                };
                reader.readAsDataURL(selectedImage);
            });

            const departmentSelect = document.getElementById("editDepartment");
            fetch("/departments")
                .then(response => response.json())
                .then(departments => {
                    // After populating the options, set the selected value if it exists
                    const selectedDepartmentName = user.department.name;
                    // Iterate through the departments and create options
                    departments.forEach(department => {
                        const option = document.createElement("option");
                        option.value = department.id;
                        option.text = department.name;
                        departmentSelect.appendChild(option);

                        //Check if the current department matches the selected department and the selected department name option is set true
                        if (selectedDepartmentName && department.name === selectedDepartmentName){
                            option.selected = true;
                        }
                    });
                })
                .catch(error => {
                    console.error("Error fetching departments:", error);
                });

            const userEditModal = document.getElementById('editUserModal');
            if (userEditModal) {
                userEditModal.classList.add('show');
                userEditModal.style.display = 'block';
            } else {
                console.log("User Edit Modal not found");
            }

            // PositionFetching for user edit
            const positionSelect = document.getElementById("editPosition");

            // Clear existing options
            positionSelect.innerHTML = "";
            //Fetch positions from the backend
            fetch("/api/user/positions")
                .then(response => response.json())
                .then(positions => {
                    // After populating the options, set the selected value if it exists
                    const selectedPositionName = user.position.positionName;
                    //positions is arrays of objects adn position is the object of one index in an array.
                    positions.forEach(position => {
                        const option = document.createElement("option");
                        option.value = position.id;
                        option.text = position.positionName || "Unknown";
                        positionSelect.appendChild(option);

                        //Check if the current position matches the selected position and the selected one option is set true
                        if (selectedPositionName && position.positionName === selectedPositionName){
                            option.selected = true;
                        }
                    });
                })
                .catch(error => {
                    console.error("Error fetching positions: ", error);
                });

            // Set the selected gender
            const genderRadio = user.gender === "male" ? document.getElementById("editMaleRadio") : document.getElementById("editFemaleRadio");
            if (genderRadio) {
                genderRadio.checked = true;
            }


            // set the date of birth which was fetched
            //as it is and ISO format we shouldn't display it in that format, therefore we used split to have YYYY/MM/DD version
            const isoDate= user.dob;
            const datePart= isoDate.split('T')[0];
            document.getElementById('editDob').value = datePart;


            // Education field
            const educationSelect = document.getElementById("editEducation");
            // Set the selected value for the education field
            const selectedEducation = user.education;
            // Iterate through the options and set the selected value
            for (let i = 0; i < educationSelect.options.length; i++) {
                if (educationSelect.options[i].value === selectedEducation) {
                    educationSelect.options[i].selected = true;
                    break;
                }
            }


        } else {
            console.log("User not found for ID:", id);
        }
    }


    document.addEventListener("DOMContentLoaded", function () {
        //User Selector fetching request
        fetch("/api/user/get-lists")
            .then(response=>response.json())
            .then(data=>{
                console.log('All User List: '+ data);

                //This is the array assigning object data of the user object lists and later used for further usages like displayEditUserModal funcitons and the id allow searching through this list
                userList = data;

                //Invoke
                refreshUserListTable(data);
                data.forEach(user => {
                    console.log(user);  // Log the entire user object
                    console.log("boolean : " + user.isActive);  // Log isActive property
                });
            })
            .catch(error => {
                console.log('Error: ', error);
            });


        function refreshUserListTable(users) {
            const table = document.getElementById('UserTable');

            // Check if DataTable is already initialized and destroy it
            if (table && $.fn.DataTable.isDataTable('#UserTable')) {
                $('#UserTable').DataTable().destroy();
            }

            return $('#UserTable').DataTable({
                data: users,
                responsive: true,
                columns: [
                    {
                        data: 'profilePictureFileName',
                        title: 'Profile',
                        render: (data) => `<img src="/static/img/${data}" alt="image" class="round-image" />`,
                        className: 'text-center'
                    },
                    { data: 'name', title: 'Users', className: 'fs-6 fw-bold text-center' },

                    { data: 'position', title: 'Position',
                        render: (data) => data ? data.positionName : '',

                        className: 'fs-6 fw-bold text-center' },
                    {
                        data: 'department',
                        title: 'Department',
                        render: (data) => data ? data.name : '',
                        className: 'fs-6 fw-bold text-center'
                    },
                    { data: 'email', title: 'Email', className: 'fs-6 fw-bold text-center' },
                    {
                        data: 'isActive', // Assuming 'isActive' is the backend boolean field
                        title: 'Status',
                        render: (data) => {

                            return `<span class="badge rounded-pill text-bg-${data ? 'success' : 'danger'}">${data ? 'Active' : 'Inactive'}</span>`;
                        },
                        className: 'text-center'
                    },
                    {
                        data: 'action',
                        title: 'Action',
                        render: (data, type, row) => `
                    <div class="d-flex justify-content-center gap-2">
                        <button class="btn btn-sm btn-primary edit-item-btn" onclick="displayEditUserModal(${row.id})">Edit</button>
                         <button class="btn btn-sm btn-${row.status ? 'danger' : 'success'}" onclick="toggleUserStatus(${row.id})">${row.status ? 'Deactivate' : 'Activate'}</button>
                        <button class="btn btn-sm btn-danger remove-item-btn" data-bs-toggle="modal" data-bs-target="#deleteRecordModal" onclick="setDeleteUid(${row.id})">Remove</button>
                    </div>
                `,
                        className: 'text-center'
                    }
                ],
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
            });
            table.buttons().container().appendTo('#UserTable .col-md-6:eq(0)');
        }

        function refreshDataTableAfterStatusEdit() {
            // Fetch new data or update the existing data
            fetch("/api/user/get-lists")
                .then(response => response.json())
                .then(data => {
                    // Get DataTable reference
                    const userTable = $('#UserTable').DataTable();

                    // Iterate through the rows and update the data
                    userTable.rows().every(function (index, element) {
                        const rowData = this.data();
                        const newData = data.find(user => user.id === rowData.id);

                        // Update the row data
                        if (newData) {
                            this.data(newData);
                        }
                    });

                    // Redraw the DataTable to reflect changes
                    userTable.draw();
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                });
        }



        // Ensure setDeleteUid is in the global scope
        window.setDeleteUid = function(uid) {
            deleteUid = uid;
            console.log("deleteUid inside setDeleteUid: " + deleteUid);
        }


        window.deleteUser = function() {
            // Find the user in the userList
            const user = userList.find(user => user.id === parseInt(deleteUid));


            fetch(`/api/user/updateStatus/${deleteUid}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },

            })
                .then(response => response.json())
                .then(data => {
                    // Handle the response data
                    console.log(data);


                    const deleteModal = document.getElementById('deleteRecordModal');
                    deleteModal.classList.remove('show');
                    // Manually remove the backdrop

                    const backdrop = document.querySelector('.modal-backdrop');
                    backdrop.parentNode.removeChild(backdrop);

                    // Refresh the DataTable UI
                    refreshDataTableAfterStatusEdit();

                })
                .catch(error => {
                    // Handle errors
                    console.error('Error:', error);
                });
        }

        // Fetch users from the backend
        fetch("/api/user/get-lists")
            .then(response => response.json())
            .then(users => {
                // Use the new function to render the DataTable
                refreshUserListTable(users);
            })
            .catch(error => {
                console.error("Error fetching users:", error);
            });



        // Get the select element by its ID to fetch departments
        const departmentSelect = document.getElementById("department");
        // Fetch departments from the backend
        fetch("/departments")
            .then(response => response.json())
            .then(departments => {
                // Iterate through the departments and create options
                departments.forEach(department => {
                    const option = document.createElement("option");
                    option.value = department.id; // Set the value based on your department data
                    option.text = department.name; // Set the text based on your department data
                    departmentSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error fetching departments:", error);
            });

        // Get the select element by its ID to fetch positions
        const positionSelect = document.getElementById("position");
        //Fetch positions from the backend
        fetch("/api/user/positions")
            .then(response => response.json())
            .then(positions => {
                console.log("Positions from backend:", positions);

                //positions is arrays of objects adn position is the object of one index in an array.
                positions.forEach(position => {
                    const option = document.createElement("option");
                    option.value = position.id;
                    option.text = position.positionName || "Unknown";
                    positionSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error fetching positions: ", error);
            });




        // Function to refresh the DataTable with new data
        function refreshDataTable(updatedUserList) {
            const userTable = $('#UserTable').DataTable();

            // Clear existing data and add new data to the DataTable
            userTable.clear().rows.add(updatedUserList).draw();
        }

        // const submitButtonToDelete = document.getElementById("submitButton");

        const submitButton= document.getElementById("submitButton");
        const form= document.getElementById("userAddForm");
        submitButton.addEventListener("click",function(event){

            // Prevent the default form submission behavior
            event.preventDefault();
            // Get form elements
            const name = document.getElementById('name').value;
            const department = document.getElementById('department').value;
            const position = document.getElementById('position').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const dob = document.getElementById('dob').value;
            const education = document.getElementById('education').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const password = document.getElementById('password').value;
            const profilePicture = document.getElementById('profilePicture').files[0];

            // Create FormData object
            const formData = new FormData();

            // Append form data to FormData object
            formData.append('name', name);
            formData.append('department', department);
            formData.append('position', position);
            formData.append('gender', gender);
            formData.append('dob', dob);
            formData.append('education', education);
            formData.append('email', email);
            formData.append('phone', phone);
            formData.append('address', address);
            formData.append('password', password);
            formData.append('file', profilePicture);

            console.log("Form Data : "+ formData);

            // Send AJAX request to the server
            fetch('/api/user/create', {
                method: 'POST',
                body: formData,


            })
                .then(response => response.json())
                .then(data => {

                    console.log('Success:', data);

                    // Fetch the updated user list after creating a new user
                    fetch("/api/user/get-lists")
                        .then(response => response.json())
                        .then(updatedUserList => {
                            // Assuming you have a function to update the DataTable, for example, refreshDataTable
                            refreshDataTable(updatedUserList);

                            // Close the modal
                            const addmemberModal = new bootstrap.Modal(document.getElementById('addmemberModal'));
                            addmemberModal.hide();
                        })
                        .catch(error => {
                            console.error("Error fetching updated user list:", error);
                        });

                })
                .catch(error => {
                    console.error('Error:', error);
                    // Handle error response from the server
                });
    })

    });







</script>
<!-- JAVASCRIPT -->
<!-- Bootstrap JS -->

<script>
    $(document).ready(function() {
        new DataTable('#example', {
            pagingType: 'full_numbers'

        });
    });



</script>
<!-- prismjs plugin -->
<script th:src="@{/assets/libs/prismjs/prism.js}"></script>
<script th:src="@{/assets/libs/list.js/list.min.js}"></script>
<script th:src="@{/assets/libs/list.pagination.js/list.pagination.min.js}"></script>

<!-- listjs init -->
<script th:src="@{/assets/js/pages/listjs.init.js}"></script>

<!-- Sweet Alerts js -->
<script th:src="@{/assets/libs/sweetalert2/sweetalert2.min.js}"></script>

</body>
<!-- Mirrored from themesbrand.com/velzon/html/material/tables-listjs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 13 Jan 2024 06:45:57 GMT -->
</html>