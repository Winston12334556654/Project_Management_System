<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable" >


<!-- Mirrored from themesbrand.com/velzon/html/material/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 13 Jan 2024 06:43:02 GMT -->
<head th:replace="~{layout :: head}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>#pieChartContainer {
        overflow: hidden;
        white-space: nowrap;
        transition: margin-left 0.5s ease;
    }
    </style>


</head>

<body>

<!-- Begin page -->
<div id="layout-wrapper">
    <div id="header-container">
        <header th:replace="~{header :: header}"></header>
    </div>


    <!-- ========== App Menu ========== -->
    <div id="navbar-container">
        <div th:replace="~{navbar :: navbar}"></div>
    </div>
</div>
<!-- END layout-wrapper -->

<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0">Projects</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboards</a></li>
                                <li class="breadcrumb-item active">Projects</li>
                            </ol>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end page title -->

            <div class="row project-wrapper">
                <div class="col-xxl-8">
                    <div class="row">
                        <div class="col-xl-4">
                            <div class="card card-animate">
                                <div class="card-body" id="projectCardBody">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-primary rounded-2 fs-2">
                                                    <i data-feather="briefcase"></i>
                                                </span>
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden ms-3">
                                            <p class="text-uppercase fw-medium text-muted text-truncate mb-3">Active Projects</p>
                                            <div class="d-flex align-items-center mb-3">
                                                <h4 id="projectCount" class="fs-4 flex-grow-1 mb-0"><span class="counter-value" data-target="0">0</span></h4>
                                            </div>
                                            <p class="text-muted text-truncate mb-0">Numbers of active projects</p>
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div>
                        </div><!-- end col -->

                        <div class="col-xl-4">
                            <div class="card card-animate">
                                <div class="card-body" id="IssueCardBody">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-primary rounded-2 fs-2">
                                                    <i data-feather="briefcase"></i>
                                                </span>
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden ms-3">
                                            <p class="text-uppercase fw-medium text-muted text-truncate mb-3">Active Issues</p>
                                            <div class="d-flex align-items-center mb-3">
                                                <h4 id="issueCount" class="fs-4 flex-grow-1 mb-0"><span class="counter-value" data-target="0">0</span></h4>
                                            </div>
                                            <p class="text-muted text-truncate mb-0">Numbers of active issues</p>
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div>
                        </div><!-- end col -->

                        <div class="col-xl-4">
                            <div class="card card-animate">
                                <div class="card-body" id="assignIssueCardBody">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm flex-shrink-0">
                                                <span class="avatar-title bg-primary rounded-2 fs-2">
                                                    <i data-feather="briefcase"></i>
                                                </span>
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden ms-3">
                                            <p class="text-uppercase fw-medium text-muted text-truncate mb-3">Active Assign Issues</p>
                                            <div class="d-flex align-items-center mb-3">
                                                <h4 id="assignIssueCount" class="fs-4 flex-grow-1 mb-0"><span class="counter-value" data-target="0">0</span></h4>
                                            </div>
                                            <p class="text-muted text-truncate mb-0">Numbers of active assigned issues</p>
                                        </div>
                                    </div>
                                </div><!-- end card body -->
                            </div>
                        </div><!-- end col -->
                    </div><!-- end row -->

                    <div class="row">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-header border-0 align-items-center d-flex">
                                    <h4 class="card-title mb-0 flex-grow-1">Projects Overview</h4>
                                </div><!-- end card header -->

                                <div class="card-header p-0 border-0 bg-light-subtle">
                                    <div class="row g-0 text-center">
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="all-projects" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Number of Projects</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="active-projects" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Active Projects</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="inactive-projects" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Inactive Projects</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                    </div>
                                </div><!-- end card header -->
                                <div class="card-body p-0 pb-2">
                                    <div>
                                        <div id="projects-overview-chart" data-colors='["--vz-primary", "--vz-warning", "--vz-success"]' class="apex-charts" dir="ltr"></div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    </div><!-- end row -->

                    <div class="row">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-header border-0 align-items-center d-flex">
                                    <h4 class="card-title mb-0 flex-grow-1">Issues Overview</h4>
                                </div><!-- end card header -->

                                <div class="card-header p-0 border-0 bg-light-subtle">
                                    <div class="row g-0 text-center">
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="all-issues" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Number of Issues</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="active-issues" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Active Issues</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                        <div class="col-8 col-sm-4">
                                            <div class="p-3 border border-dashed border-start-0">
                                                <h5 id="inactive-issues" class="mb-1"><span class="counter-value" data-target="0">0</span></h5>
                                                <p class="text-muted mb-0">Inactive Issues</p>
                                            </div>
                                        </div>
                                        <!--end col-->
                                    </div>
                                </div><!-- end card header -->
                                <div class="card-body p-0 pb-2">
                                    <div>
                                        <div id="issues-overview-chart" data-colors='["--vz-primary", "--vz-warning", "--vz-success"]' class="apex-charts" dir="ltr"></div>
                                    </div>
                                </div><!-- end card body -->
                            </div><!-- end card -->
                        </div><!-- end col -->
                    </div><!-- end row -->
                </div><!-- end col -->



                <div class="col-xxl-12" style="display: inline-block; margin-right: 10px;">
                    <div class="row" id="cardRow" style="overflow-y: hidden; float-wrap: wrap">
                    <div class="card col-xl-3"  style="width: 100%; height: 400px; overflow-y: auto;">
                        <div class="card-header border-0">
                            <h4 class="card-title mb-0">Project Pie Charts</h4>
                        </div><!-- end cardheader -->
                        <div class="card-body-wrapper">
                        <div class="card-body"  id="pieChartContainer" style="max-height: 100%;">
                            <!--<div class="row display-flex">
                            &lt;!&ndash; Container for dynamically created canvas elements &ndash;&gt;
                            </div>-->
                            <div class="row display-flex" id="chartRow">
                            </div>
                        </div><!-- end cardbody -->
                        </div>
                    </div><!-- end card -->
                    </div>
                </div><!-- end col -->

            </div><!-- end row -->

            <div class="row">
                <div class="col-xl-7">
                    <div class="card card-height-100">
                        <div class="card-header d-flex align-items-center">
                            <h4 class="card-title flex-grow-1 mb-0">Yours projects</h4>
<!--                            <div class="flex-shrink-0">-->
<!--                                <a href="javascript:void(0);" class="btn btn-soft-info btn-sm shadow-none">Export Report</a>-->
<!--                            </div>-->
                        </div><!-- end cardheader -->
                        <div class="card-body">
                            <div class="table-responsive table-card">
                                <table class="table table-nowrap table-centered align-middle">
                                    <thead class="bg-light text-muted">
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">Status</th>
                                    </tr><!-- end tr -->
                                    </thead><!-- thead -->

                                    <tbody id="my-projects">

                                    </tbody><!-- end tbody -->
                                </table><!-- end table -->
                            </div>

                        </div><!-- end card body -->
                    </div><!-- end card -->
                </div><!-- end col -->

                <div class="col-xl-5">
                    <div class="card card-height-100">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1 py-1">My Tasks</h4>
                        </div><!-- end card header -->
                        <div class="card-body">
                            <div class="table-responsive table-card">
                                <table class="table table-borderless table-nowrap table-centered align-middle mb-0">
                                    <thead class="table-light text-muted">
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">Deadline</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Assignee</th>
                                    </tr>
                                    </thead><!-- end thead -->
                                    <tbody id="my-issue-table">

                                    </tbody><!-- end tbody -->
                                </table><!-- end table -->
                            </div>
                            <div class="mt-3 text-center">
                                <a href="javascript:void(0);" class="text-muted text-decoration-underline">Load
                                    More</a>
                            </div>
                        </div><!-- end cardbody -->
                    </div><!-- end card -->
                </div><!-- end col -->
            </div><!-- end row -->

            <div class="row">
                <div class="col-xxl-4" th:if="${user.role == T(ai.group2.project_management_system.model.Enum.Role).TEAMLEADER or user.role == T(ai.group2.project_management_system.model.Enum.Role).MEMBER}">
                    <div class="card card-height-100">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Members from your departments</h4>
                        </div><!-- end card header -->

                        <div class="card-body">

                            <div class="table-responsive table-card">
                                <table class="table table-borderless table-nowrap align-middle mb-0">
                                    <thead class="table-light text-muted">
                                    <tr>
                                        <th scope="col">Profile</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Role</th>
                                    </tr><!-- end tr -->
                                    </thead>
                                    <tbody id="project-table-body">

                                    </tbody><!-- end tbody -->
                                </table><!-- end table -->
                            </div>
                        </div><!-- end cardbody -->
                    </div><!-- end card -->
                </div><!-- end col -->

                <!--<div class="col-xxl-4 col-lg-6" >-->
                <div th:class="${user.role == T(ai.group2.project_management_system.model.Enum.Role).TEAMLEADER or user.role == T(ai.group2.project_management_system.model.Enum.Role).MEMBER} ? 'col-xxl-4 col-lg-6' : 'col-xxl-6 col-lg-6'">

                <div class="card card-height-100">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Issues Status</h4>
                        </div><!-- end card header -->

                        <div class="card-body">
                            <div id="issues-status" data-colors='["--vz-success", "--vz-primary", "--vz-warning", "--vz-danger"]' class="apex-charts" dir="ltr"></div>
                            <div class="mt-3">
                                <div class="d-flex justify-content-center align-items-center mb-4">
                                    <h2 id="total-issues" class="me-3 ff-secondary mb-0">0</h2>
                                    <div>
                                        <p class="text-muted mb-0">Total Issues</p>
                                        <p class="text-success fw-medium mb-0">
                                            <span class="badge bg-success-subtle text-success p-1 rounded-circle"><i class="ri-arrow-right-up-line"></i></span> +3 New
                                        </p>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                    <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-success align-middle me-2"></i>
                                        Completed</p>
                                    <div>
                                        <span id="completedCount-issues" class="text-muted pe-5">0</span>
                                    </div>
                                </div><!-- end -->
                                <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                    <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-primary align-middle me-2"></i>
                                        In Progress</p>
                                    <div>
                                        <span id="inProgressCount-issues" class="text-muted pe-5">0</span>

                                    </div>
                                </div><!-- end -->
                                <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                    <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-warning align-middle me-2"></i>
                                        To Do</p>
                                    <div>
                                        <span id="todoCount-issues" class="text-muted pe-5">0</span>
                                    </div>
                                </div><!-- end -->
                                <div class="d-flex justify-content-between py-2">
                                    <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-danger align-middle me-2"></i>
                                        Overdue</p>
                                    <div>
                                        <span id="overdueCount-issues" class="text-muted pe-5">0</span>
                                    </div>
                                </div><!-- end -->
                                <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                    <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-success align-middle me-2"></i>
                                        Pending</p>
                                    <div>
                                        <span id="pendingCount-issues" class="text-muted pe-5">0</span>
                                    </div>
                                </div><!-- end -->
                            </div>
                        </div><!-- end cardbody -->
                    </div><!-- end card -->
                </div><!-- end col -->

                <div th:class="${user.role == T(ai.group2.project_management_system.model.Enum.Role).TEAMLEADER or user.role == T(ai.group2.project_management_system.model.Enum.Role).MEMBER} ? 'col-xxl-4 col-lg-6' : 'col-xxl-6 col-lg-6'">
                    <div class="card card-height-100">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Projects Status</h4>
                        </div><!-- end card header -->

                        <div class="card-body">
                            <div id="prjects-status" data-colors='["--vz-success", "--vz-primary", "--vz-warning", "--vz-danger"]' class="apex-charts" dir="ltr"></div>
                            <div class="mt-3">
                                <div class="d-flex justify-content-center align-items-center mb-4">
                                    <h2 id="total-projects" class="me-3 ff-secondary mb-0">0</h2>
                                    <div>
                                        <p class="text-muted mb-0">Total Projects</p>
                                        <p class="text-success fw-medium mb-0">
                                            <span class="badge bg-success-subtle text-success p-1 rounded-circle"><i class="ri-arrow-right-up-line"></i></span> +3 New
                                        </p>
                                    </div>
                                </div>

                                    <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                        <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-success align-middle me-2"></i>
                                            Completed</p>
                                        <div>
                                            <span id="completedCount-projects" class="text-muted pe-5">0</span>
                                        </div>
                                    </div><!-- end -->
                                    <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                        <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-primary align-middle me-2"></i>
                                            In Progress</p>
                                        <div>
                                            <span id="inProgressCount-projects" class="text-muted pe-5">0</span>

                                        </div>
                                    </div><!-- end -->
                                    <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                        <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-warning align-middle me-2"></i>
                                            To Do</p>
                                        <div>
                                            <span id="todoCount-projects" class="text-muted pe-5">0</span>
                                        </div>
                                    </div><!-- end -->
                                    <div class="d-flex justify-content-between py-2">
                                        <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-danger align-middle me-2"></i>
                                            Overdue</p>
                                        <div>
                                            <span id="overdueCount-projects" class="text-muted pe-5">0</span>
                                        </div>
                                    </div><!-- end -->
                                    <div class="d-flex justify-content-between border-bottom border-bottom-dashed py-2">
                                        <p class="fw-medium mb-0"><i class="ri-checkbox-blank-circle-fill text-success align-middle me-2"></i>
                                            Pending</p>
                                        <div>
                                            <span id="pendingCount-projects" class="text-muted pe-5">0</span>
                                        </div>
                                    </div><!-- end -->
                            </div>
                        </div><!-- end cardbody -->
                    </div><!-- end card -->
                </div><!-- end col -->
            </div><!-- end row -->

        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

</div>

<div>
    <h1 th:text="${user.role}"></h1>
</div>
<div th:replace="~{layout :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>      m n

<!--<script>-->
<!--    document.addEventListener('DOMContentLoaded', function () {-->
<!--        // Initial static data-->
<!--        let taskData = [-->
<!--            { Issue: 'Issue 1', completion: 'complete' },-->
<!--            { Issue: 'Issue 2', completion: 'complete' },-->
<!--            { Issue: 'Issue 3', completion: 'inprogress' },-->
<!--            { Issue: 'Issue 4', completion: 'inprogress' },-->
<!--            { Issue: 'Issue 5', completion: 'todo' },-->
<!--        ];-->

<!--        // Update pie chart on DOMContentLoaded-->
<!--        updatePieChart(taskData);-->
<!--    });-->

<!--    // Function to update pie chart dynamically-->
<!--    function updatePieChart(data) {-->
<!--        const completedCount = data.filter(task => task.completion === 'complete').length;-->
<!--        const inProgressCount = data.filter(task => task.completion === 'inprogress').length;-->
<!--        const todoCount = data.filter(task => task.completion === 'todo').length;-->

<!--        // Update the counts in the HTML-->
<!--        document.getElementById('completedCount').textContent = completedCount;-->
<!--        document.getElementById('inProgressCount').textContent = inProgressCount;-->
<!--        document.getElementById('todoCount').textContent = todoCount;-->

<!--        // Calculate completion percentage-->
<!--        const totalTasks = data.length;-->
<!--        const completionPercentage = (completedCount / totalTasks) * 100;-->

<!--        // Create or update the pie chart-->
<!--        const ctx = document.getElementById('pieChart').getContext('2d');-->
<!--        if (window.myPieChart) {-->
<!--            // If the chart already exists, update the data-->
<!--            window.myPieChart.data.datasets[0].data = [completionPercentage, inProgressCount, todoCount];-->
<!--            window.myPieChart.update();-->
<!--        } else {-->
<!--            // If the chart doesn't exist, create it-->
<!--            window.myPieChart = new Chart(ctx, {-->
<!--                type: 'pie',-->
<!--                data: {-->
<!--                    labels: ['Completed', 'In Progress', 'To-Do'],-->
<!--                    datasets: [{-->
<!--                        data: [completionPercentage, inProgressCount, todoCount],-->
<!--                        backgroundColor: ['#28a745', '#ffc107', '#007bff'],-->
<!--                    }],-->
<!--                },-->
<!--                options: {-->
<!--                    tooltips: {-->
<!--                        callbacks: {-->
<!--                            label: function (tooltipItem, data) {-->
<!--                                const dataset = data.datasets[tooltipItem.datasetIndex];-->
<!--                                const total = dataset.data.reduce((previousValue, currentValue) => previousValue + currentValue);-->
<!--                                const currentValue = dataset.data[tooltipItem.index];-->
<!--                                const percentage = ((currentValue / total) * 100).toFixed(2);-->
<!--                                return `${data.labels[tooltipItem.index]}: ${percentage}%`;-->
<!--                            },-->
<!--                        },-->
<!--                    },-->
<!--                },-->
<!--            });-->
<!--        }-->
<!--    }-->
<!--</script>-->

<script>

    async function fetchIssuesByProjectId(projectId) {
        try {
            const response = await fetch(`${projectId}/issues`);

            if (!response.ok) {
                throw new Error('Failed to fetch issues');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error:', error.message);
        }
    }

    // Function to fetch project IDs
    async function fetchAllProjectIds() {
        try {
            const response = await fetch('/all-project-ids');

            if (!response.ok) {
                throw new Error('Failed to fetch project IDs');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error:', error.message);
            return [];
        }
    }
    // Function to fetch project name by project ID
    function fetchProjectNameById(projectId) {
        return fetch(`/project-name/${projectId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch project name');
                }
                return response.text();
            })
            .catch(error => {
                console.error('Error:', error.message);
                return null;
            });
    }

    // Example usage
    let projectIds = [];

    fetchAllProjectIds()
        .then(ids => {
            projectIds = ids;
            console.log('Fetched project IDs:', projectIds);

            // Iterate through each project
            projectIds.forEach(projectId => {


                        // Fetch issues for each project
                        fetchIssuesByProjectId(projectId)
                            .then(issues => {
                                console.log(`Fetched issues for Project ${projectId}:`, issues);

                                // Check if there are issues associated with the project
                                if (issues && issues.length > 0) {
                                    // Count the occurrences of each status for the current project
                                    const statusCounts = {};
                                    issues.forEach(issue => {
                                        statusCounts[issue.status] = (statusCounts[issue.status] || 0) + 1;
                                    });

                                    fetchProjectNameById(projectId)
                                        .then(projectName => {
                                            console.log("Project Name : " + projectName);


                                            // Display the project name as a heading or label before the pie chart
                                            const heading = document.createElement('h3');
                                            heading.textContent = `Project: ${projectName}`;

                                            console.log("Text Content : "+ heading.textContent);

                                            const container = document.getElementById('pieChartContainer');
                                            if (container) {
                                                container.appendChild(heading);
                                            } else {
                                                console.error('Container element not found.');
                                            }
                                        })
                                        .catch(error => {
                                            console.error(`Error fetching project name for Project ${projectId}:`, error.message);
                                        });


                                    // Extract labels and data for Chart.js in the order of existing statuses
                                    const labels = Object.keys(statusCounts);
                                    const data = labels.map(status => statusCounts[status]);

                                    // Map the status to corresponding colors
                                    const statusColors = {
                                        'TODO': 'rgba(200, 200, 200, 0.7)',
                                        'INPROGRESS': 'rgba(135, 206, 250, 0.7)',
                                        'PENDING': 'rgba(255, 255, 150, 0.7)',
                                        'OVERDUE': 'rgba(255, 150, 150, 0.7)',
                                        'COMPLETED': 'rgba(144, 238, 144, 0.7)'
                                    };

                                    // Log the colors assigned for each issue status
                                    labels.forEach(status => {
                                        console.log(`Color for ${status}:`, statusColors[status]);
                                    });
                                    const container = document.getElementById('pieChartContainer');
                                    const chartRow = document.getElementById('chartRow');
                                    // Create a new canvas for each project
                                    const canvas = document.createElement('canvas');
                                    canvas.width =300; // Set your desired width
                                    canvas.height =300; // Set your desired height

                                    canvas.style.maxWidth = '100%'; // Limit the width
                                    canvas.style.maxHeight = '100%';
                                    // Append the canvas to the chartRow
                                    const chartCol = document.createElement('div');
                                    chartCol.classList.add('col-4'); // Adjust the column class as needed
                                    chartCol.appendChild(canvas);
                                    chartRow.appendChild(chartCol);
                                    /*if (container) {
                                        container.appendChild(canvas);
                                    } else {
                                        console.error('Container element not found.');
                                    }
*/
                                    // Create a pie chart with custom tooltip for each project
                                    new Chart(canvas.getContext('2d'), {
                                        type: 'pie',
                                        data: {
                                            labels: labels,
                                            datasets: [{
                                                data: data,
                                                backgroundColor: labels.map(status => statusColors[status]),
                                                borderColor: labels.map(status => statusColors[status].replace('0.7', '1')),
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            tooltips: {
                                                callbacks: {
                                                    label: function (tooltipItem, data) {
                                                        const dataset = data.datasets[tooltipItem.datasetIndex];
                                                        const total = dataset.data.reduce((previousValue, currentValue) => previousValue + currentValue);
                                                        const currentValue = dataset.data[tooltipItem.index];
                                                        const percentage = ((currentValue / total) * 100).toFixed(2);

                                                        console.log('Tooltip Data:', {
                                                            total,
                                                            currentValue,
                                                            percentage,
                                                            projectName
                                                        });

                                                        console.log('Before return in tooltip callback');
                                                        // Return the formatted label
                                                        return `${projectName}: ${percentage}%`;
                                                    }
                                                }
                                            }
                                        }
                                    });
                                } else {
                                    console.log(`No issues found for Project ${projectId}. Skipping pie chart creation.`);
                                }
                            })
                            .catch(error => {
                                console.error(`Error fetching issues for Project ${projectId}:`, error.message);
                            });


            })
                .catch(error => {
                    console.error('Error fetching project IDs:', error.message);
                });
        });





</script>


</body>
<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Include DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

<script th:src="@{/assets/js/main-dashboard.js}"></script>

<!-- Mirrored from themesbrand.com/velzon/html/material/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 13 Jan 2024 06:43:59 GMT -->
</html>
